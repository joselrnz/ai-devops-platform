# Default values for agent-deployment
# This is a YAML-formatted file.

replicaCount: 2

image:
  repository: ghcr.io/myorg/llm-agent
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  annotations: {}

ingress:
  enabled: false
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: agent.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: agent-tls
      hosts:
        - agent.example.com

resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 1000m
    memory: 2Gi

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  # Custom metrics (requires metrics-server and prometheus-adapter)
  customMetrics: []
  # - type: Pods
  #   pods:
  #     metric:
  #       name: http_requests_per_second
  #     target:
  #       type: AverageValue
  #       averageValue: "1000"

# Vertical Pod Autoscaler
verticalPodAutoscaler:
  enabled: false
  updateMode: "Auto"  # Off, Initial, Recreate, Auto

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - agent-deployment
          topologyKey: kubernetes.io/hostname

# Environment variables
env:
  - name: LOG_LEVEL
    value: "info"
  - name: METRICS_PORT
    value: "8080"
  - name: OTEL_ENABLED
    value: "true"

# Environment variables from secrets
envFrom: []
# - secretRef:
#     name: agent-secrets

# Secrets management (Vault integration)
vault:
  enabled: false
  role: "agent-role"
  secrets:
    - path: secret/data/agents/api-keys
      key: anthropic_key
      envVar: ANTHROPIC_API_KEY

# Health checks
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Startup probe (for slow-starting containers)
startupProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30

# Prometheus ServiceMonitor (requires Prometheus Operator)
serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s
  labels: {}
  annotations: {}

# Network Policy
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: ingress-nginx
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to:
      - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 443  # HTTPS to external APIs
        - protocol: TCP
          port: 53   # DNS
        - protocol: UDP
          port: 53   # DNS

# Resource Quota (applied to namespace)
resourceQuota:
  enabled: false
  hard:
    requests.cpu: "10"
    requests.memory: "20Gi"
    limits.cpu: "20"
    limits.memory: "40Gi"
    persistentvolumeclaims: "5"

# Limit Range (applied to namespace)
limitRange:
  enabled: false
  limits:
    - max:
        cpu: "4"
        memory: "8Gi"
      min:
        cpu: "100m"
        memory: "128Mi"
      default:
        cpu: "500m"
        memory: "512Mi"
      defaultRequest:
        cpu: "200m"
        memory: "256Mi"
      type: Container

# Volumes
volumes: []
# - name: cache
#   emptyDir: {}

volumeMounts: []
# - name: cache
#   mountPath: /tmp/cache

# Init containers
initContainers: []
# - name: wait-for-db
#   image: busybox:latest
#   command: ['sh', '-c', 'until nc -z postgres 5432; do sleep 1; done']

# Sidecar containers
sidecars: []
# - name: log-forwarder
#   image: fluent/fluent-bit:latest
#   volumeMounts:
#     - name: logs
#       mountPath: /var/log
